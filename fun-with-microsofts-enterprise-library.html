<!DOCTYPE html>
<html lang="en">
<head>
          <title>Adam's Entropy</title>
        <meta charset="utf-8" />



    <meta name="tags" content=".net" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://adamgetchell.org/">Adam's Entropy <strong>One particular random walk through life</strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://adamgetchell.org/fun-with-microsofts-enterprise-library.html" rel="bookmark"
         title="Permalink to Fun with Microsoft’s Enterprise Library">Fun with Microsoft&#8217;s Enterprise&nbsp;Library</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2007-09-22T23:42:00-07:00">
      Sat 22 September 2007
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="http://adamgetchell.org/author/adam-getchell.html">Adam Getchell</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>Oh yeah, back to my day-job: I&#8217;m a&nbsp;programmer.  </p>
<p>So we&#8217;ve got a new application to update the current stone-tablet
process in the University that determines if students actually&nbsp;graduate.  </p>
<p>Now, I like to write good code, and furthermore, if someone else writes
it for me, that&#8217;s even better. So if you are working on the .<span class="caps">NET</span>
platform, you&#8217;d do well to look at the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=0325B97A-9534-4349-8038-D56B38EC394C&amp;displaylang=en">Enterprise
Library</a>.  </p>
<p>Of course, this is several thousand lines of code to pore over, good
stuff, but unfortunately we have these minor annoying things called
deadlines which prevents us from taking the time to grok everything&nbsp;properly.  </p>
<p>Come to think of it, this happens in Physics, too &#8212; I never have enough
time to actually understand all the details of the problems I&#8217;m supposed
to be solving, but my advisor assures me that this is the proper state
of things in research, as opposed to writing text books, and three
guesses as to which one gets you&nbsp;tenure.  </p>
<p>Back to the matter at hand &#8212; the Enterprise Library. Looking around at
some good <a href="http://blog.hishambaz.com/archive/2005/01/29/194.aspx">working
examples</a> ,
hilarity and pandemonium ensues when you try to do something simple like
write to the Event Log when your application barfs. (Did I mention this
doesn&#8217;t come up a lot because instrumenting software seems to be a &#8230;
novelty?) I&#8217;m pretty sure that developers should <span
style="font-weight: bold;">not</span> be doing things like editing the
Registry, installing Services, or setting accounts programs run under
with full admin rights &#8212; I was a system administrator in a previous
job, and I <span style="font-weight: bold;">hated</span> letting
programmers do those kind of&nbsp;things.  </p>
<p>So I won&#8217;t inflict the same damage on our own, long-suffering&nbsp;sysadmin.  </p>
<p>Now, my 52-line class solution doesn&#8217;t do all the bells and whistles the
<span class="caps">EL</span> does, but it sure doesn&#8217;t require all the nastiness&nbsp;above:  </p>
<div class="cf">

<span class="cb1">using</span> System;

<span class="cb1">using</span> System.Diagnostics;

 

<span class="cb1">namespace</span> <span class="caps">CAESDO</span>

{

    <span class="cb2">///</span><span class="cb3"></span><span
class="cb2">\<summary\></span>

    <span class="cb2">///</span><span class="cb3"> Methods to handle
error reporting</span>

    <span class="cb2">///</span><span class="cb3"></span><span
class="cb2">\</summary\></span>

    <span class="cb1">public</span> <span class="cb1">class</span>
ErrorHandler

    {

        <span class="cb1">public</span> ErrorHandler()

        {

            <span class="cb3">// Register application as source for
Application log</span>

            <span class="cb1">if</span>
(!EventLog.SourceExists(&#8220;FacultyStudentSurveys&#8221;))

                EventLog.CreateEventSource(&#8220;FacultyStudentSurveys&#8221;,
&#8220;Application&#8221;);

        }

 

        <span class="cb2">///</span><span class="cb3"></span><span
class="cb2">\<summary\></span>

        <span class="cb2">///</span><span class="cb3"> Writes an error
message to the Application Event Log</span>

        <span class="cb2">///</span><span class="cb3"></span><span
class="cb2">\</summary\></span>

        <span class="cb2">///</span><span class="cb3"></span><span
class="cb2">\<param name="error"\></span><span class="cb3">The thrown
exception</span><span class="cb2">\</param\></span>

        <span class="cb1">internal</span> <span class="cb1">void</span>
WriteToEventLog(Exception error)

        {

            <span class="cb1">const</span> <span
class="cb1">string</span> source = &#8220;Commencement&#8221;;

            <span class="cb1">const</span> <span
class="cb1">string</span> logName = &#8220;Application&#8221;;

            EventLogEntryType enumType = EventLogEntryType.Error;

 

            EventLog objectLog = <span class="cb1">new</span>
EventLog(logName);

            objectLog.Source = source;

            objectLog.WriteEntry(error.Message, enumType, 1 );

        }

 

        <span class="cb1">internal</span> <span class="cb1">void</span>
WriteToEventLog(<span class="cb1">string</span> message, <span
class="cb1">bool</span> success)

        {

            <span class="cb1">const</span> <span
class="cb1">string</span> source = &#8220;Commencement&#8221;;

            <span class="cb1">const</span> <span
class="cb1">string</span> logName = &#8220;Application&#8221;;

            EventLogEntryType enumType;

 

            <span class="cb1">if</span> (success)

            {

                enumType = EventLogEntryType.Information;

            }

            <span class="cb1">else</span>

            {

                enumType = EventLogEntryType.Error;

            }

            EventLog objectLog = <span class="cb1">new</span>
EventLog(logName);

            objectLog.Source = source;

            objectLog.WriteEntry(message, enumType);

        }

    }

}

</div>

<p>I&#8217;m sure I&#8217;ve missed something obvious.&nbsp;Anyone?  </p>
<p>I just got a reply from the Hisam Baz, author of the above weblog which
says, &#8220;Why write 52 lines of code when you can write&nbsp;1?&#8221;.  </p>
<p>To which I reply, &#8220;I&#8217;d be happy to write 1 line of code &#8212; if it&nbsp;works.&#8221;  </p>
<p>Which brings us to the second&nbsp;problem:  </p>
<p><span style="font-weight: bold;">Non-portable references to the Global
Assembly Cache in <span class="caps">ASP</span>.<span class="caps">NET</span></span>  </p>
<p>Once you actually try to use the Enterprise Library, you&#8217;ll often come
across this bit of&nbsp;advice:  </p>
<p><span class="dquo">&#8220;</span><span style="font-weight: bold; font-style: italic;">References  </p>
<p></span><span style="font-style: italic;">Then from your application, add
references to
Microsoft.Practices.EnterpriseLibrary.Configuration.dll</span><br />
<span style="font-style: italic;">and
Microsoft.Practices.EnterpriseLibrary.Logging.dll from the C:\Program
Files\Microsoft Enterprise Library\bin\ directory. You should
consider signing the assemblies and then adding them to the <span class="caps">GAC</span>. You
should also add a copy of the assemblies to C:\Program Files\Microsoft
Visual Studio .<span class="caps">NET</span> 2003\Common7\<span class="caps">IDE</span>. Once you do that, you can select
the assemblies directly from the &#8220;Add Reference&#8221; dialog. One you&#8217;ve
added the reference, then add the appropriate using statement - using
Microsoft.Practices.EnterpriseLibrary.Logging - to your&nbsp;code.&#8221;</span>  </p>
<p>There&#8217;s only one problem &#8212; it doesn&#8217;t&nbsp;work.  </p>
<ol>
<li>
<p>When Visual Studio 2003 .<span class="caps">NET</span> looks for references in the Global
Assembly Cache, it never updates its view of the <span class="caps">GAC</span> in response to what
you&#8217;ve added &#8212; that&#8217;s done by the
<a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;306149">registry</a>
(bleah). Which is why you&#8217;ve got to add a copy where <span class="caps">VS</span> can find&nbsp;it.  </p>
</li>
<li>
<p>When writing <span class="caps">ASP</span>.<span class="caps">NET</span> applications, references should be against
assemblies in the webserver <span class="caps">GAC</span>. And naturally, installer projects
written in <span class="caps">VS</span> 2003 do not install the files in the <span class="caps">GAC</span> automatically, as
they do for the web application itself. So now you have to manually add
assemblies to the <span class="caps">GAC</span> and write registry entries for each assembly to be
resolved by the .<span class="caps">NET</span>&nbsp;runtime.  </p>
</li>
</ol>
<p>Wait, why are we <a href="http://www.sellsbrothers.com/news/showTopic.aspx?ixTopic=1199">using the
<span class="caps">GAC</span></a>&nbsp;again?  </p>
<p>Okay, looks like I&#8217;ll have to wade through <a href="http://www.grimes.demon.co.uk/workshops/fusionWS.htm">Richard Grime&#8217;s Fusion
Workshop</a>. Except
that it doesn&#8217;t cover the case I&#8217;m interested in.&nbsp;Joy.  </p>
<p>Well, I sure hope that the 10 lines of code I&#8217;ll end up emitting in this
exercise will exceed the several thousand I could be writing if I just
wrote everything&nbsp;myself.  </p>
<p>What&#8217;s that again about the virtues of programmers? Laziness,
impatience, and hubris. Oh, alright&nbsp;then.</p>
</p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>