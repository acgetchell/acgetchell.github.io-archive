---
layout: post
title: "Using Enterprise Library Logging"
date: 2005-02-23
comments: false
categories:
 - .net
---

<div class='post'>
To get logging working without pesky WMI/Performance counter errors on <span style="font-style: italic;">every</span> logged event:<br /><br />Per <a href="http://weblogs.asp.net/tomholl/archive/2005/02/18/376187.aspx#FeedBack">Tom Hollander's weblog</a><br /><br />Go to the Logging project, Project Properties dialog for the Common project, and under Configuration Properties\Build, find the Conditional Compilation Properties property and remove ;USEWMI;USEPERFORMANCECOUNTER for the build type you're interested in (ReleaseFinal, in this case).<br /><br />Ignore compile warnings about DB2 goop.<br /><br />Delete any old project references and re-add reference to new version in C:\Program Files\Microsoft Enterprise Library\src\Logging\bin\ReleaseFinal.<br /><br />Then add an appropriate using statement and use in code:<br /><br /><style type="text/css">.cf { font-family: Courier New; font-size: 10pt; color: black; background: white; border-top: windowtext 1pt solid; padding-top: 0pt; border-left: windowtext 1pt solid; padding-left: 0pt; border-right: windowtext 1pt solid; padding-right: 0pt; border-bottom: windowtext 1pt solid; padding-bottom: 0pt; }.cl { margin: 0px; }.cb1 { color: blue; }.cb2 { color: gray; }.cb3 { color: green; }</style><div class="cf"><p class="cl"><span class="cb1">using</span> System;</p><p class="cl"><span class="cb1">using</span> System.Collections;</p><p class="cl"><span class="cb1">using</span> System.ComponentModel;</p><p class="cl"><span class="cb1">using</span> System.Data;</p><p class="cl"><span class="cb1">using</span> System.Drawing;</p><p class="cl"><span class="cb1">using</span> System.Web;</p><p class="cl"><span class="cb1">using</span> System.Web.SessionState;</p><p class="cl"><span class="cb1">using</span> System.Web.UI;</p><p class="cl"><span class="cb1">using</span> System.Web.UI.WebControls;</p><p class="cl"><span class="cb1">using</span> System.Web.UI.HtmlControls;</p><p class="cl"><span class="cb1">using</span> Microsoft.Practices.EnterpriseLibrary.Logging;</p><p class="cl"><span class="cb1">using</span> Microsoft.Practices.EnterpriseLibrary.Logging.Tracing;</p><p class="cl">&nbsp;</p><p class="cl"><span class="cb1">namespace</span> CAESDO</p><p class="cl">{</p><p class="cl">&nbsp;&nbsp;&nbsp; <span class="cb2">///</span><span class="cb3"> </span><span class="cb2">&lt;summary&gt;</span></p><p class="cl">&nbsp;&nbsp;&nbsp; <span class="cb2">///</span><span class="cb3"> Summary description for WebForm1.</span></p><p class="cl">&nbsp;&nbsp;&nbsp; <span class="cb2">///</span><span class="cb3"> </span><span class="cb2">&lt;/summary&gt;</span></p><p class="cl">&nbsp;&nbsp;&nbsp; <span class="cb1">public</span> <span class="cb1">class</span> DefaultPage : System.Web.UI.Page</p><p class="cl">&nbsp;&nbsp;&nbsp; {</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb1">private</span> <span class="cb1">void</span> Page_Load(<span class="cb1">object</span> sender, System.EventArgs e)</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb3">// Put user code to initialize the page here</span></p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; LogEntry logEntry = <span class="cb1">new</span> LogEntry();</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; logEntry.Message = "Starting up the application";</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Logger.Write(logEntry);</p><p class="cl">&nbsp;</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb3">// Now this is cool! Tracing flow of code through application</span></p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb3">// and it was simple to add an EmailAlert with an EmailSink</span></p><p class="cl">&nbsp;</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb1">using</span> (<span class="cb1">new</span> Tracer("Trace"))</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Logger.Write("Hello world");</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; Logger.Write("Hello by e-mail", "EmailAlerts",5,3000,Microsoft.Practices.EnterpriseLibrary.Logging.Severity.Information, "An e-mail message logging all kinds of stuff");</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p><p class="cl">&nbsp;</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p><p class="cl">&nbsp;</p><p class="cl"><span class="cb1">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #region</span> Web Form Designer generated code</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb1">override</span> <span class="cb1">protected</span> <span class="cb1">void</span> OnInit(EventArgs e)</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb3">//</span></p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb3">// CODEGEN: This call is required by the ASP.NET Web Form Designer.</span></p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb3">//</span></p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; InitializeComponent();</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb1">base</span>.OnInit(e);</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p><p class="cl">&nbsp;</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb2">///</span><span class="cb3"> </span><span class="cb2">&lt;summary&gt;</span></p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb2">///</span><span class="cb3"> Required method for Designer support - do not modify</span></p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb2">///</span><span class="cb3"> the contents of this method with the code editor.</span></p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb2">///</span><span class="cb3"> </span><span class="cb2">&lt;/summary&gt;</span></p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb1">private</span> <span class="cb1">void</span> InitializeComponent()</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp; </p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span class="cb1">this</span>.Load += <span class="cb1">new</span> System.EventHandler(<span class="cb1">this</span>.Page_Load);</p><p class="cl">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }</p><p class="cl"><span class="cb1">&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; #endregion</span></p><p class="cl">&nbsp;&nbsp;&nbsp; }</p><p class="cl">}</p></div><br /><br /><span style="font-style: italic;">Voila!</span><br /><br />It'd sure make it easier to post code to my weblog if VisualStudio 2005 included <a href="http://www.jtleigh.com/people/colin/software/CopySourceAsHtml/">CopySourceAsHtml</a> functionality. This is a great application, too bad it doesn't work for me. I seem to have uncovered the first interaction between CSAH and a trial VisualPerl installation that won't uninstall.<br /><br />Par for the course.<br /><br />Although, I've suggested to the Visual Studio 2005 guys that they add this feature.<br /><br />P.S. Collin worked to fix CSAH, and I nuked and reinstalled my system, including Visual Studio 2003.NET. That seems to have done the trick.</div>
