---
layout: post
title: "Reflection tools for F#"
date: 2011-04-19
comments: false
categories:
 - f#
---

<div class='post'>
I went to the fabuluous <a href="http://codeconf.com/">CodeConf 2011</a> (view <a href="http://lanyrd.com/2011/codeconf/slides/">slides</a>, <a href="https://github.com/blog/835-codeconf-2011-mission-accomplished">recaps</a> <a href="http://www.peebs.org/2011/04/codeconf-2011-day-one/">here</a>, <a href="http://thechangelog.com/post/4507882708/codeconf-sunday-summary">here</a>, and <a href="https://convore.com/codeconf/">here</a>) and the first talk was "Tinker Fairy" <a href="http://twitter.com/#!/drnic">Dr. Nic</a> telling us to <a href="http://lanyrd.com/2011/codeconf/sdmxb/">build tools</a> to do stuff that we don't want to remember later. Then build tools to build those tools -- tool tools.<br /><br />One of the neat modern takes on Lisp <a href="http://en.wikipedia.org/wiki/S-expression">s-expressions</a> in modern virtual machines like the CLR is <a href="http://en.wikipedia.org/wiki/Reflection_(computer_programming)">Reflection</a>. At least, I think that it will be useful in reversing Lisp macros and expressions into the F#/OCAML equivalents.<br /><br /><a href="http://flyingfrogblog.blogspot.com/">Dr. Jon Harrop</a> gives a terse but informative example in his book <a href="http://fsharpnews.blogspot.com/2010/04/visual-f-2010-for-technical-computing.html">Visual F# 2010 for Technical Computing</a>.<br /><br />First, we want a union type which represents (i.e. abstracts away) the F# type system:<br /><br /><script src="https://gist.github.com/926994.js?file=F%23%20Types"></script><br /><br />Next, we want a (recursive) function (called, straightforwardly enough, type_of) that reflects (using FSharpType) and translates a given System.Type object into one of the 'a ty union types defined previously:<br /><br /><script src="https://gist.github.com/926997.js"> </script><br /><br />This then allows us to emit the following two liner which can parse objects such as the List.fold function! (Note: everything after the ;; is the F# Interactive response.)<br /><br /><script src="https://gist.github.com/927012.js"> </script><br /><br />Neat stuff! I've a thousand or two lines of Lisp to look at, so this is not something I want to have to remember later.</div>
