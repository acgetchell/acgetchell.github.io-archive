---
layout: post
title: "Fun with Microsoft Enterprise Library, part 2"
date: 2005-02-17
comments: false
categories:
 - .net
---

<div class='post'>
Okay, I can see that this is going to be a long series ....<br /><br />Here's what I'm talking about on how to get Visual Studio to see Enterprise Library assemblies without browsing (taken from the GotDotNet workspace patterns & practices: Enterprise Library: Message Boards):<br /><br />"<span style="font-style: italic;">Do you want to see EntLib assemblies in Add References message box?</span><br /><span style="font-style: italic;">Create a text file named entlib.reg, and add this content:</span><br /><span style="font-style: italic;">Windows Registry Editor Version 5.00</span><br /><br /><span style="font-style: italic;">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\VisualStudio\7.1\AssemblyFolders\Enterprise Library]</span><br /><span style="font-style: italic;">@="C:\\Program Files\\Microsoft Enterprise Library\\bin\\"</span><br /><br /><span style="font-style: italic;">Double click on the file and you'll be asked whether to add this registry key. Click yes, restart vs.net and there you go.</span><br /><span style="font-style: italic;">(it is assumed that assemblies are in their default folder - otherwise, change the path above).</span>"<br /><br />Sigh. I really really try to avoid the Registry when possible.<br /><br />There's another neat trick for sorting out the structure of the Enterprise Library: open one of the solutions in Visual Studio, select Project-> Visio UML -> Reverse Engineer.<br /><br />Too bad all it actually does is generate a 75K blank Visio file, because Visio is unable to resolve all of the references.<br /><br />I suppose this will work for code that's so simple that a UML diagram isn't needed.<br /><br />Moving right along, I've also found how to sign all of the Enterprise Library Asemblies! You just generate your public/private key pair, and then reference them in the GlobalAssemblyInfo.cs file in:<br /><br />C:\Program Files\Microsoft Enterprise Library\src<br />This file gets referenced by every project when it's compiled. Yay!<br /><br />Except that every project's AssemblyInfo.cs contains blank references:<br /><br />[assembly : AssemblyDelaySign(false)]<br />[assembly : AssemblyKeyFile("")]<br />[assembly : AssemblyKeyName("")]<br /><br />Which overwrite what gets pulled in from GlobalAssemblyInfo.cs.<br /><br />So you have to go through every project's AssemblyInfo.cs file and remove those 3 lines.<br /><br />Sigh. There's 23 projects in the Security section alone, which is sort of the <span style="font-style: italic;">sine qua non </span>for using the EL to begin with, for my purposes.<br /><br />Well, Caching, Configuration, Data, ExceptionHandling, and Logging are also useful.<br /><br />One step at a time.<br /><br />I've gotten Logging to work. Unfortunately, every time it logs it throws three error messages:<br /><br /><span class="messagecontent"><span style="font-style: italic;">"Failed to create instances of performance counter 'Distributor: # of Logs Distributed/Sec' - The requested Performance Counter is not a custom counter, it has to be initialized as ReadOnly..</span><br /><br /><span style="font-style: italic;">For more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp."</span><br /><br /><span style="font-style: italic;">"Failed to fire the WMI event 'LoggingLogWrittenEvent'. Exception: System.Exception: This schema for this assembly has not been registered with WMI.</span><br /><span style="font-style: italic;">at System.Management.Instrumentation.Instrumentation.Initialize(Assembly assembly)</span><br /><span style="font-style: italic;">at System.Management.Instrumentation.Instrumentation.GetInstrumentedAssembly(Assembly assembly)</span><br /><span style="font-style: italic;">at System.Management.Instrumentation.BaseEvent.Fire()</span><br /><span style="font-style: italic;">at Microsoft.Practices.EnterpriseLibrary.Common.Instrumentation.InstrumentedEvent.FireWmiEventCore(BaseEvent baseEvent).</span><br /><br /><span style="font-style: italic;">For more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp."</span><br /><br />and<br /><br /><span style="font-style: italic;">"Failed to create instances of performance counter 'Client: # of Logs Written/Sec' - The requested Performance Counter is not a custom counter, it has to be initialized as ReadOnly..</span><br /><br /><span style="font-style: italic;">For more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp."</span><br /><br />Presumably these counters are installed as part of the EL service installation, but going through the batch file yields for logging:<br /><br />@ECHO.<br />@ECHO ---------------------------------------------------------------------------------<br />@ECHO Installing Services for the Logging and Instrumentation Application Block<br />@ECHO ---------------------------------------------------------------------------------<br />@ECHO.<br /><br />if Exist Microsoft.Practices.EnterpriseLibrary.Logging.dll installutil %1 Microsoft.Practices.EnterpriseLibrary.Logging.dll<br />@if errorlevel 1 goto :error<br /><br />So I'd like to break out whatever counters are needed so I can install them on the webserver, and ideally, be able to script this installation for production code on a production server with an Installer project.<br /><br />Although I'm strongly tempted to just go back to using my ErrorHandling class, which doesn't need anything installed anywhere.<br /><br />No, I'll persist in using the EL. I'm sure there will be a payoff -- like extending the Logging class to handle XML.<br /><br />Of course, to extend the EL one should be cognizant of all the Unit Tests there built to ensure its continued functionality. So I need that book on Test Driven Development real soon now.<br /><br />Well, at least I'm not bored.<br /></span></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Good work! this was the only credible place where I found some solution and respite..</div>
</div>
<div class='comment'>
<div class='author'>Paul Whitaker</div>
<div class='content'>
LOL, yes it's important to not be bored. Thanks for the wrap-up on some of the stuff you can do with EL assemblies, I'll probably do the registry trick :P</div>
</div>
</div>
